<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Calificación - The Illuminated FC</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
        min-height: 100vh;
        padding: 10px; /* Reducido para móviles */
      }

      .container {
        max-width: 100%; /* Ajustado para ser más flexible */
        width: 100%;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        border: 2px solid #ffd700;
      }

      .header {
        background: linear-gradient(135deg, #000000, #333333);
        color: #ffd700;
        padding: 20px;
        text-align: center;
        position: relative;
        border-bottom: 2px solid #ffd700;
      }

      .header::before {
        content: "";
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        width: 80px; /* Tamaño reducido para móviles */
        height: 80px;
        background-image: url("./images/Logo.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        opacity: 1;
      }

      .header h1 {
        font-size: 1.8rem; /* Reducido para móviles */
        margin-bottom: 8px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        color: #ffd700;
      }

      .header p {
        font-size: 1rem;
        opacity: 0.9;
        color: #ffffff;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 350px; /* Ajustado para pantallas medianas */
        gap: 20px;
        padding: 20px;
      }

      .form-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      }

      .form-section h2 {
        color: #000;
        margin-bottom: 15px;
        font-size: 1.3rem;
        border-bottom: 2px solid #ffd700;
        padding-bottom: 8px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #555;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
      }

      .criteria-section {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .criteria-section h3 {
        color: #495057;
        margin-bottom: 10px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .radio-group {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 10px;
      }

      .radio-option {
        flex: 1 1 100px; /* Más flexible para móviles */
        min-width: 100px;
      }

      .radio-option input[type="radio"] {
        display: none;
      }

      .radio-option label {
        display: block;
        padding: 8px;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .radio-option input[type="radio"]:checked + label {
        background: linear-gradient(135deg, #000000, #333333);
        color: #ffd700;
        border-color: #ffd700;
        transform: translateY(-1px);
        box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3);
      }

      .bonus-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
      }

      .checkbox-option {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px;
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .checkbox-option:hover {
        border-color: #ffd700;
        background: #f8f9fa;
      }

      .checkbox-option input[type="checkbox"]:checked + span {
        color: #ffd700;
        font-weight: 600;
      }

      .btn {
        background: linear-gradient(135deg, #000000, #333333);
        color: #ffd700;
        border: 1px solid #ffd700;
        padding: 12px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 15px;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 10px rgba(255, 215, 0, 0.4);
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: #000000;
      }

      .btn:active {
        transform: translateY(0);
      }

      .results-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        position: sticky;
        top: 10px;
        max-height: 85vh;
        overflow-y: auto;
      }

      .results-section h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3rem;
        border-bottom: 2px solid #ff6b6b;
        padding-bottom: 8px;
      }

      .player-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        border-left: 4px solid #667eea;
        transition: transform 0.3s ease;
      }

      .player-card:hover {
        transform: translateX(3px);
      }

      .player-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 8px;
      }

      .player-score {
        font-size: 1.8rem;
        font-weight: 800;
        color: #667eea;
        margin-bottom: 8px;
      }

      .score-breakdown {
        font-size: 0.85rem;
        color: #666;
        line-height: 1.4;
      }

      .total-score {
        background: linear-gradient(135deg, #000000, #333333);
        color: #ffd700;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 15px;
        border: 1px solid #ffd700;
      }

      .total-score h3 {
        font-size: 1.3rem;
        margin-bottom: 8px;
        color: #ffffff;
      }

      .total-score .score {
        font-size: 2.5rem;
        font-weight: 900;
        color: #ffd700;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }

      .clear-btn {
        background: #dc3545;
        margin-top: 10px;
        border: 1px solid #dc3545;
      }

      .clear-btn:hover {
        background: #c82333;
        border-color: #c82333;
        color: white;
      }

      .ranking-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .ranking-table th {
        background: linear-gradient(135deg, #000000, #333333);
        color: #ffd700;
        padding: 10px 8px;
        text-align: left;
        font-weight: 600;
        border-bottom: 1px solid #ffd700;
      }

      .ranking-table th:first-child {
        text-align: center;
        width: 50px;
      }

      .ranking-table td {
        padding: 10px 8px;
        border-bottom: 1px solid #e9ecef;
        color: #333;
        font-size: 0.9rem;
      }

      .ranking-table td:first-child {
        text-align: center;
        font-weight: bold;
        font-size: 1.1rem;
      }

      .ranking-table tr:hover {
        background-color: #f8f9fa;
      }

      .ranking-table .rank-1 {
        background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
        border-left: 3px solid #ffd700;
      }

      .ranking-table .rank-2 {
        background: linear-gradient(90deg, rgba(192, 192, 192, 0.1), transparent);
        border-left: 3px solid #c0c0c0;
      }

      .ranking-table .rank-3 {
        background: linear-gradient(90deg, rgba(205, 127, 50, 0.1), transparent);
        border-left: 3px solid #cd7f32;
      }

      .position-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        font-weight: bold;
        font-size: 12px;
      }

      .position-1 {
        background: #ffd700;
        color: #000;
      }

      .position-2 {
        background: #c0c0c0;
        color: #000;
      }

      .position-3 {
        background: #cd7f32;
        color: #fff;
      }

      .position-other {
        background: #6c757d;
        color: #fff;
      }

      .toggle-buttons {
        display: flex;
        gap: 8px;
        margin: 15px 0;
        justify-content: center;
        flex-wrap: wrap;
      }

      .toggle-btn {
        padding: 8px 15px;
        border: 1px solid #ffd700;
        background: white;
        color: #000;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        flex: 1 1 100px;
        text-align: center;
      }

      .toggle-btn.active {
        background: linear-gradient(135deg, #000000, #333333);
        color: #ffd700;
      }

      .toggle-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3);
      }

      .player-history {
        margin-top: 8px;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 2px solid #ffd700;
      }

      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
        border-bottom: 1px solid #e9ecef;
        font-size: 0.85rem;
      }

      .history-item:last-child {
        border-bottom: none;
      }

      .expand-btn {
        background: #ffd700;
        color: #000;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 11px;
        font-weight: 600;
        margin-right: 5px;
      }

      .score-cell {
        font-size: 1.2rem;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      .performance-indicators {
        display: flex;
        gap: 4px;
        margin: 8px 0;
      }

      .indicator {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 12px;
      }

      .star {
        background: #ffd93d;
        color: #333;
      }
      .fire {
        background: #ff6b6b;
        color: white;
      }
      .check {
        background: #51cf66;
        color: white;
      }
      .warning {
        background: #ffa94d;
        color: white;
      }
      .cross {
        background: #ff8787;
        color: white;
      }

      /* Media Queries para Responsividad */
      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .results-section {
          position: static;
          max-height: none;
        }

        .header::before {
          width: 60px;
          height: 60px;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .header p {
          font-size: 0.9rem;
        }

        .form-section h2,
        .results-section h2 {
          font-size: 1.2rem;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 5px;
        }

        .container {
          border-radius: 6px;
          border-width: 1px;
        }

        .header {
          padding: 15px;
        }

        .header::before {
          width: 50px;
          height: 50px;
          right: 5px;
        }

        .header h1 {
          font-size: 1.3rem;
        }

        .header p {
          font-size: 0.85rem;
        }

        .main-content {
          padding: 10px;
        }

        .form-section,
        .results-section {
          padding: 10px;
        }

        .form-group input,
        .form-group select {
          padding: 8px;
          font-size: 13px;
        }

        .radio-group {
          gap: 6px;
        }

        .radio-option {
          min-width: 80px;
        }

        .radio-option label {
          padding: 6px;
          font-size: 0.85rem;
        }

        .bonus-section {
          grid-template-columns: 1fr;
        }

        .btn {
          padding: 10px;
          font-size: 13px;
        }

        .toggle-btn {
          padding: 6px 10px;
          font-size: 12px;
        }

        .ranking-table th,
        .ranking-table td {
          padding: 8px 6px;
          font-size: 0.85rem;
        }

        .ranking-table th:first-child,
        .ranking-table td:first-child {
          width: 40px;
        }

        .player-card {
          padding: 10px;
        }

        .player-name {
          font-size: 1rem;
        }

        .player-score {
          font-size: 1.5rem;
        }

        .total-score .score {
          font-size: 2rem;
        }
      }

      @media (max-width: 480px) {
        .header h1 {
          font-size: 1.2rem;
        }

        .header p {
          font-size: 0.8rem;
        }

        .header::before {
          width: 40px;
          height: 40px;
        }

        .form-section h2,
        .results-section h2 {
          font-size: 1.1rem;
        }

        .criteria-section h3 {
          font-size: 1rem;
        }

        .radio-option label {
          font-size: 0.8rem;
          padding: 5px;
        }

        .checkbox-option {
          font-size: 0.8rem;
          padding: 8px;
        }

        .btn {
          padding: 8px;
          font-size: 12px;
        }

        .toggle-btn {
          font-size: 11px;
        }

        .ranking-table th,
        .ranking-table td {
          font-size: 0.8rem;
          padding: 6px 4px;
        }

        .position-badge {
          width: 20px;
          height: 20px;
          font-size: 10px;
        }

        .player-card {
          padding: 8px;
        }

        .player-score {
          font-size: 1.3rem;
        }

        .score-breakdown {
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>⚽ The Illuminated FC</h1>
        <p>Sistema de Calificación de Jugadores</p>
      </div>

      <div class="main-content">
        <div class="form-section">
          <h2>📋 Datos del Jugador</h2>

          <div class="form-group">
            <label for="playerName">Nombre del Jugador:</label>
            <input
              type="text"
              id="playerName"
              placeholder="Ingrese el nombre del jugador"
            />
          </div>

          <div class="form-group">
            <label for="matchDate">Fecha del Partido:</label>
            <input type="date" id="matchDate" />
          </div>

          <div class="criteria-section">
            <h3>📅 Asistencia (3 pts máx)</h3>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="asist_3" name="asistencia" value="3" />
                <label for="asist_3">Presente y puntual<br />+3 pts</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="asist_1" name="asistencia" value="1" />
                <label for="asist_1">Presente pero tarde<br />+1 pt</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="asist_just" name="asistencia" value="1" />
                <label for="asist_just">Falta justificada<br />+1 pt</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="asist_0" name="asistencia" value="0" />
                <label for="asist_0">Falta sin aviso<br />0 pts</label>
              </div>
            </div>
          </div>

          <div class="criteria-section">
            <h3>⚽ Rendimiento (0-5 pts)</h3>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="rend_5" name="rendimiento" value="5" />
                <label for="rend_5">⭐ Sobresaliente<br />5 pts</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="rend_4" name="rendimiento" value="4" />
                <label for="rend_4">🔥 Muy bien<br />4 pts</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="rend_3" name="rendimiento" value="3" />
                <label for="rend_3">✅ Cumplió<br />3 pts</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="rend_2" name="rendimiento" value="2" />
                <label for="rend_2">⚠️ Regular<br />2 pts</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="rend_1" name="rendimiento" value="1" />
                <label for="rend_1">❌ Bajo<br />1 pt</label>
              </div>
            </div>
          </div>

          <div class="criteria-section">
            <h3>🤝 Actitud y Compromiso (0-2 pts)</h3>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="act_2" name="actitud" value="2" />
                <label for="act_2">Excelente<br />+2 pts</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="act_1" name="actitud" value="1" />
                <label for="act_1">Buena<br />+1 pt</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="act_0" name="actitud" value="0" />
                <label for="act_0">Regular<br />0 pts</label>
              </div>
            </div>
          </div>

          <div class="criteria-section">
            <h3>🏆 Bonificaciones Extra</h3>
            <div class="bonus-section">
              <label class="checkbox-option">
                <input type="checkbox" id="mvp" value="3" />
                <span>🏆 MVP del partido (+3)</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="gol" value="2" />
                <span>⚽ Gol marcado (+2)</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="asistencia_gol" value="1" />
                <span>🎯 Asistencia de gol (+1)</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="porteria_cero" value="2" />
                <span>🥅 Portería en cero (+2)</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" id="juego_limpio" value="1" />
                <span>🤝 Juego limpio (+1)</span>
              </label>
            </div>
          </div>

          <button class="btn" onclick="calcularCalificacion()">
            Calcular Calificación
          </button>
        </div>

        <div class="results-section">
          <h2>📊 Resultados</h2>

          <div class="toggle-buttons">
            <button
              class="toggle-btn active"
              id="rankingBtn"
              onclick="mostrarVista('ranking')"
            >
              🏆 Ranking General
            </button>
            <button
              class="toggle-btn"
              id="historialBtn"
              onclick="mostrarVista('historial')"
            >
              📋 Historial Completo
            </button>
            <button
              class="toggle-btn"
              id="avanzadoBtn"
              onclick="mostrarVista('avanzado')"
            >
              ⚡ Funciones Avanzadas
            </button>
          </div>

          <div id="resultados">
            <div style="text-align: center; color: #666; padding: 30px">
              <h3>No hay calificaciones registradas</h3>
              <p>
                Complete el formulario y presione "Calcular Calificación" para
                ver los resultados.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let jugadores = [];
      let vistaActual = "ranking"; // 'ranking' o 'historial'

      // Clave para localStorage
      const STORAGE_KEY = "illuminated_fc_data";

      // Cargar datos al iniciar
      function cargarDatos() {
        try {
          const datosGuardados = localStorage.getItem(STORAGE_KEY);
          if (datosGuardados) {
            const datos = JSON.parse(datosGuardados);
            jugadores = datos.jugadores || [];
            vistaActual = datos.vistaActual || "ranking";

            // Actualizar botones de vista
            document.getElementById("rankingBtn").classList.remove("active");
            document.getElementById("historialBtn").classList.remove("active");
            document
              .getElementById(vistaActual + "Btn")
              .classList.add("active");

            console.log(
              `✅ Datos cargados: ${jugadores.length} registros encontrados`
            );
            mostrarNotificacion("Datos cargados correctamente", "success");
          } else {
            console.log("ℹ️ No se encontraron datos previos");
          }
        } catch (error) {
          console.error("❌ Error al cargar datos:", error);
          mostrarNotificacion("Error al cargar datos previos", "error");
          jugadores = [];
        }
      }

      // Guardar datos automáticamente
      function guardarDatos() {
        try {
          const datos = {
            jugadores: jugadores,
            vistaActual: vistaActual,
            fechaGuardado: new Date().toISOString(),
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(datos));
          console.log("💾 Datos guardados automáticamente");
        } catch (error) {
          console.error("❌ Error al guardar datos:", error);
          mostrarNotificacion("Error al guardar datos", "error");
        }
      }

      // Mostrar notificaciones
      function mostrarNotificacion(mensaje, tipo = "info") {
        const notification = document.createElement("div");
        notification.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                border-radius: 6px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 90%;
                box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                font-size: 0.9rem;
            `;

        switch (tipo) {
          case "success":
            notification.style.backgroundColor = "#28a745";
            break;
          case "error":
            notification.style.backgroundColor = "#dc3545";
            break;
          case "warning":
            notification.style.backgroundColor = "#ffc107";
            notification.style.color = "#000";
            break;
          default:
            notification.style.backgroundColor = "#17a2b8";
        }

        notification.textContent = mensaje;
        document.body.appendChild(notification);

        // Animación de entrada
        setTimeout(() => {
          notification.style.transform = "translateX(0)";
        }, 100);

        // Eliminar después de 3 segundos
        setTimeout(() => {
          notification.style.transform = "translateX(100%)";
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      // Establecer fecha actual por defecto
      document.getElementById("matchDate").valueAsDate = new Date();

      function calcularCalificacion() {
        const nombre = document.getElementById("playerName").value.trim();
        const fecha = document.getElementById("matchDate").value;

        if (!nombre) {
          alert("Por favor ingrese el nombre del jugador");
          return;
        }

        if (!fecha) {
          alert("Por favor seleccione la fecha del partido");
          return;
        }

        // Obtener valores básicos
        const asistencia = parseInt(
          document.querySelector('input[name="asistencia"]:checked')?.value || 0
        );
        const rendimiento = parseInt(
          document.querySelector('input[name="rendimiento"]:checked')?.value ||
            0
        );
        const actitud = parseInt(
          document.querySelector('input[name="actitud"]:checked')?.value || 0
        );

        // Obtener bonificaciones
        let bonificaciones = 0;
        const bonificacionesDetalle = [];
        const checkboxes = document.querySelectorAll(
          '.criteria-section:last-child input[type="checkbox"]:checked'
        );
        checkboxes.forEach((checkbox) => {
          bonificaciones += parseInt(checkbox.value);
          bonificacionesDetalle.push({
            nombre: checkbox.parentElement.textContent.trim(),
            puntos: parseInt(checkbox.value),
          });
        });

        const total = asistencia + rendimiento + actitud + bonificaciones;

        // Crear objeto jugador
        const jugador = {
          nombre: nombre,
          fecha: fecha,
          asistencia: asistencia,
          rendimiento: rendimiento,
          actitud: actitud,
          bonificaciones: bonificaciones,
          bonificacionesDetalle: bonificacionesDetalle,
          total: total,
          timestamp: new Date(),
        };

        // Agregar a la lista
        jugadores.unshift(jugador);

        // Guardar automáticamente
        guardarDatos();

        // Mostrar notificación
        mostrarNotificacion(
          `Calificación de ${nombre} guardada correctamente`,
          "success"
        );

        // Actualizar visualización
        actualizarResultados();

        // Limpiar formulario parcialmente (mantener fecha)
        document.getElementById("playerName").value = "";
        document
          .querySelectorAll('input[type="radio"]')
          .forEach((radio) => (radio.checked = false));
        document
          .querySelectorAll('input[type="checkbox"]')
          .forEach((checkbox) => (checkbox.checked = false));
      }

      function mostrarVista(vista) {
        vistaActual = vista;

        // Actualizar botones
        document.getElementById("rankingBtn").classList.remove("active");
        document.getElementById("historialBtn").classList.remove("active");
        document.getElementById("avanzadoBtn").classList.remove("active");
        document.getElementById(vista + "Btn").classList.add("active");

        // Guardar preferencia
        guardarDatos();

        // Actualizar contenido
        actualizarResultados();
      }

      function consolidarJugadores() {
        const jugadoresConsolidados = {};

        // Agrupar por nombre
        jugadores.forEach((jugador) => {
          const nombre = jugador.nombre.toLowerCase().trim();
          if (!jugadoresConsolidados[nombre]) {
            jugadoresConsolidados[nombre] = {
              nombre: jugador.nombre, // Mantener capitalización original
              partidos: [],
              totalPartidos: 0,
              sumaTotal: 0,
              promedio: 0,
              mejorPartido: 0,
              peorPartido: Infinity,
              ultimaFecha: null,
            };
          }

          const consolidado = jugadoresConsolidados[nombre];
          consolidado.partidos.push(jugador);
          consolidado.totalPartidos++;
          consolidado.sumaTotal += jugador.total;
          consolidado.mejorPartido = Math.max(
            consolidado.mejorPartido,
            jugador.total
          );
          consolidado.peorPartido = Math.min(
            consolidado.peorPartido,
            jugador.total
          );

          // Encontrar la fecha más reciente
          const fechaPartido = new Date(jugador.fecha);
          if (
            !consolidado.ultimaFecha ||
            fechaPartido > consolidado.ultimaFecha
          ) {
            consolidado.ultimaFecha = fechaPartido;
          }
        });

        // Calcular promedios
        Object.values(jugadoresConsolidados).forEach((jugador) => {
          jugador.promedio = jugador.sumaTotal / jugador.totalPartidos;
          // Ordenar partidos por fecha (más reciente primero)
          jugador.partidos.sort(
            (a, b) => new Date(b.fecha) - new Date(a.fecha)
          );
        });

        return Object.values(jugadoresConsolidados);
      }

      function actualizarResultados() {
        const container = document.getElementById("resultados");

        if (jugadores.length === 0) {
          container.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        <h3>No hay calificaciones registradas</h3>
                        <p>Complete el formulario y presione "Calcular Calificación" para ver los resultados.</p>
                    </div>
                `;
          return;
        }

        if (vistaActual === "ranking") {
          mostrarRankingConsolidado(container);
        } else if (vistaActual === "historial") {
          mostrarHistorialCompleto(container);
        } else if (vistaActual === "avanzado") {
          mostrarFuncionalidadesAvanzadas(container);
        }
      }

      function mostrarRankingConsolidado(container) {
        const jugadoresConsolidados = consolidarJugadores();
        const jugadoresOrdenados = jugadoresConsolidados.sort(
          (a, b) => b.promedio - a.promedio
        );

        let html = "";

        // Estadísticas generales
        const promedioGeneral =
          jugadores.reduce((sum, j) => sum + j.total, 0) / jugadores.length;
        const totalPartidos = jugadores.length;
        const jugadoresUnicos = jugadoresConsolidados.length;

        html += `
                <div class="total-score">
                    <h3>📊 Estadísticas Generales</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin-top: 10px;">
                        <div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #FFD700;">${promedioGeneral.toFixed(
                              1
                            )}</div>
                            <div style="font-size: 0.85rem; color: #FFFFFF;">Promedio General</div>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #51cf66;">${totalPartidos}</div>
                            <div style="font-size: 0.85rem; color: #FFFFFF;">Total Partidos</div>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #ff6b6b;">${jugadoresUnicos}</div>
                            <div style="font-size: 0.85rem; color: #FFFFFF;">Jugadores</div>
                        </div>
                    </div>
                </div>
            `;

        // Tabla de ranking consolidada
        html += `
                <h3 style="color: #000; margin: 15px 0 10px 0; display: flex; align-items: center; gap: 8px;">
                    🏆 Ranking de Jugadores (Promedio)
                </h3>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Jugador</th>
                            <th>Promedio</th>
                            <th>Partidos</th>
                            <th>Mejor</th>
                            <th>Último Partido</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        jugadoresOrdenados.forEach((jugador, index) => {
          const position = index + 1;
          const positionClass = position <= 3 ? `rank-${position}` : "";
          const positionBadgeClass =
            position === 1
              ? "position-1"
              : position === 2
              ? "position-2"
              : position === 3
              ? "position-3"
              : "position-other";

          html += `
                    <tr class="${positionClass}">
                        <td>
                            <div class="position-badge ${positionBadgeClass}">
                                ${position}
                            </div>
                        </td>
                        <td style="font-weight: 600; color: #000;">${
                          jugador.nombre
                        }</td>
                        <td class="score-cell">${jugador.promedio.toFixed(
                          1
                        )}</td>
                        <td>${jugador.totalPartidos}</td>
                        <td style="color: #51cf66; font-weight: bold;">${
                          jugador.mejorPartido
                        }</td>
                        <td>${jugador.ultimaFecha.toLocaleDateString(
                          "es-ES"
                        )}</td>
                        <td>
                            <button class="expand-btn" onclick="toggleHistorialJugador('${
                              jugador.nombre
                            }')">
                                Ver Historial
                            </button>
                        </td>
                    </tr>
                    <tr id="historial-${jugador.nombre.replace(
                      /\s+/g,
                      "-"
                    )}" style="display: none;">
                        <td colspan="7">
                            <div class="player-history">
                                <h4 style="margin-bottom: 8px; color: #000;">Historial de ${
                                  jugador.nombre
                                }</h4>
                                ${jugador.partidos
                                  .map(
                                    (partido, idx) => `
                                    <div class="history-item">
                                        <div>
                                            <strong>${new Date(
                                              partido.fecha
                                            ).toLocaleDateString(
                                              "es-ES"
                                            )}</strong> - 
                                            ${partido.total} pts 
                                            (A:${partido.asistencia} | R:${
                                      partido.rendimiento
                                    } | C:${partido.actitud}${
                                      partido.bonificaciones > 0
                                        ? ` | B:${partido.bonificaciones}`
                                        : ""
                                    })
                                        </div>
                                        <button onclick="eliminarPartido(${jugadores.indexOf(
                                          partido
                                        )})" 
                                            style="background: #dc3545; color: white; border: none; border-radius: 4px; 
                                                   padding: 2px 6px; cursor: pointer; font-size: 10px;">
                                            Eliminar
                                        </button>
                                    </div>
                                `
                                  )
                                  .join("")}
                            </div>
                        </td>
                    </tr>
                `;
        });

        html += `
                    </tbody>
                </table>
                
                <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="exportarDatos()" style="flex: 1; background: #28a745; border-color: #28a745;">
                        📤 Exportar Datos
                    </button>
                    <button class="btn" onclick="importarDatos()" style="flex: 1; background: #17a2b8; border-color: #17a2b8;">
                        📥 Importar Datos
                    </button>
                </div>
                
                <button class="btn clear-btn" onclick="limpiarTodo()">🗑️ Limpiar Todo el Historial</button>
            `;

        container.innerHTML = html;
      }

      function mostrarHistorialCompleto(container) {
        const jugadoresOrdenados = [...jugadores].sort(
          (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
        );

        let html = "";

        // Estadísticas generales
        const promedio =
          jugadores.reduce((sum, j) => sum + j.total, 0) / jugadores.length;
        const maxScore = Math.max(...jugadores.map((j) => j.total));
        const minScore = Math.min(...jugadores.map((j) => j.total));

        html += `
                <div class="total-score">
                    <h3>📊 Estadísticas del Historial</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin-top: 10px;">
                        <div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #FFD700;">${promedio.toFixed(
                              1
                            )}</div>
                            <div style="font-size: 0.85rem; color: #FFFFFF;">Promedio</div>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #51cf66;">${maxScore}</div>
                            <div style="font-size: 0.85rem; color: #FFFFFF;">Máximo</div>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #ff6b6b;">${minScore}</div>
                            <div style="font-size: 0.85rem; color: #FFFFFF;">Mínimo</div>
                        </div>
                    </div>
                </div>
            `;

        html += `
                <h3 style="color: #000; margin: 15px 0 10px 0;">
                    📋 Historial Completo de Partidos
                </h3>
            `;

        jugadoresOrdenados.forEach((jugador, index) => {
          const originalIndex = jugadores.findIndex(
            (j) => j.timestamp.toString() === jugador.timestamp.toString()
          );
          const performanceClass = getPerformanceClass(jugador.rendimiento);
          const performanceIcon = getPerformanceIcon(jugador.rendimiento);

          html += `
                    <div class="player-card">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div class="player-name">${jugador.nombre}</div>
                                <div class="player-score">${
                                  jugador.total
                                } pts</div>
                                <div class="performance-indicators">
                                    <div class="indicator ${performanceClass}" title="Rendimiento: ${
            jugador.rendimiento
          }/5">
                                        ${performanceIcon}
                                    </div>
                                    <div style="margin-left: 8px; font-size: 0.85rem; color: #666;">
                                        ${new Date(
                                          jugador.fecha
                                        ).toLocaleDateString("es-ES")}
                                    </div>
                                </div>
                            </div>
                            <button onclick="eliminarPartido(${originalIndex})" style="background: #dc3545; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px; margin-left: 8px;">×</button>
                        </div>
                        <div class="score-breakdown">
                            <strong>Desglose:</strong><br>
                            Asistencia: ${jugador.asistencia} pts | 
                            Rendimiento: ${jugador.rendimiento} pts | 
                            Actitud: ${jugador.actitud} pts
                            ${
                              jugador.bonificaciones > 0
                                ? ` | Bonificaciones: ${jugador.bonificaciones} pts`
                                : ""
                            }
                        </div>
                    </div>
                `;
        });

        html += `
                <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="exportarDatos()" style="flex: 1; background: #28a745; border-color: #28a745;">
                        📤 Exportar Datos
                    </button>
                    <button class="btn" onclick="importarDatos()" style="flex: 1; background: #17a2b8; border-color: #17a2b8;">
                        📥 Importar Datos
                    </button>
                </div>
                
                <button class="btn clear-btn" onclick="limpiarTodo()">🗑️ Limpiar Todo</button>
            `;

        container.innerHTML = html;
      }

      function toggleHistorialJugador(nombreJugador) {
        const id = `historial-${nombreJugador.replace(/\s+/g, "-")}`;
        const elemento = document.getElementById(id);
        if (elemento.style.display === "none") {
          elemento.style.display = "";
        } else {
          elemento.style.display = "none";
        }
      }

      function eliminarPartido(index) {
        if (confirm("¿Está seguro de eliminar este partido del historial?")) {
          jugadores.splice(index, 1);
          actualizarResultados();
        }
      }

      function getPerformanceClass(rendimiento) {
        switch (rendimiento) {
          case 5:
            return "star";
          case 4:
            return "fire";
          case 3:
            return "check";
          case 2:
            return "warning";
          case 1:
            return "cross";
          default:
            return "cross";
        }
      }

      function getPerformanceIcon(rendimiento) {
        switch (rendimiento) {
          case 5:
            return "⭐";
          case 4:
            return "🔥";
          case 3:
            return "✅";
          case 2:
            return "⚠️";
          case 1:
            return "❌";
          default:
            return "❌";
        }
      }

      function limpiarTodo() {
        if (confirm("¿Está seguro de eliminar todas las calificaciones?")) {
          jugadores = [];
          actualizarResultados();
        }
      }

      // Función para exportar datos
      function exportarDatos() {
        try {
          const datos = {
            jugadores: jugadores,
            fechaExportacion: new Date().toISOString(),
            totalRegistros: jugadores.length,
            version: "1.0",
          };

          const dataStr = JSON.stringify(datos, null, 2);
          const dataUri =
            "data:application/json;charset=utf-8," +
            encodeURIComponent(dataStr);

          const exportFileDefaultName = `calificaciones_illuminated_fc_${
            new Date().toISOString().split("T")[0]
          }.json`;

          const linkElement = document.createElement("a");
          linkElement.setAttribute("href", dataUri);
          linkElement.setAttribute("download", exportFileDefaultName);
          linkElement.click();

          mostrarNotificacion(
            `Datos exportados: ${datos.totalRegistros} registros`,
            "success"
          );
        } catch (error) {
          console.error("Error al exportar:", error);
          mostrarNotificacion("Error al exportar datos", "error");
        }
      }

      // Función para importar datos
      function importarDatos() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json";
        input.onchange = function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const datos = JSON.parse(e.target.result);

                if (datos.jugadores && Array.isArray(datos.jugadores)) {
                  if (
                    confirm(
                      `¿Importar ${datos.jugadores.length} registros? Esto se agregará a los datos existentes.`
                    )
                  ) {
                    jugadores = [...jugadores, ...datos.jugadores];
                    guardarDatos();
                    mostrarNotificacion(
                      `${datos.jugadores.length} registros importados correctamente`,
                      "success"
                    );
                    actualizarResultados();
                  }
                } else {
                  mostrarNotificacion("Formato de archivo inválido", "error");
                }
              } catch (error) {
                console.error("Error al importar:", error);
                mostrarNotificacion("Error al leer el archivo", "error");
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      }

      // Inicializar aplicación
      function inicializar() {
        cargarDatos();
        actualizarResultados();

        // Mostrar notificación de bienvenida si hay datos
        if (jugadores.length > 0) {
          setTimeout(() => {
            mostrarNotificacion(
              `Bienvenido de vuelta! ${jugadores.length} registros cargados`,
              "info"
            );
          }, 1000);
        }
      }

      // Inicializar cuando la página esté lista
      document.addEventListener("DOMContentLoaded", inicializar);
    </script>
  </body>
</html>